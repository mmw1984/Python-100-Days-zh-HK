## 分支同循環結構實戰

通過前面兩節課嘅學習，大家對 Python 中嘅分支結構同循環結構已經有咗初步嘅認知。**分支結構同循環結構係構建程式邏輯嘅基礎**，佢哋嘅重要性不言而喻，但係對於初學者嚟講呢個都係比較困難嘅部分。好多人對分支結構同循環結構嘅語法係能夠理解嘅，但係遇到實際問題嘅時候又無法下手；**睇明別人嘅代碼好容易，但係要自己寫出類似嘅代碼卻又好難**。如果你都有同樣嘅問題同困惑，千萬唔好沮喪，呢個只係因為你嘅程式編寫之旅先啱啱開始，**你嘅練習量仲未達到令你可以隨心所欲寫出代碼嘅程度**，只要加強程式編寫練習，通過量嘅積累嚟產生質嘅變化，呢個問題遲早都會解決嘅。

### 例子1：100以內嘅質數

> **說明**：質數指嘅係只能被 1 同自身整除嘅正整數（唔包括 1），之前我哋寫過判斷質數嘅代碼，呢度相當於係一個升級版本。

```python
"""
輸出100以內嘅質數

Version: 1.0
Author: 駱昊
"""
for num in range(2, 100):
    is_prime = True
    for i in range(2, int(num ** 0.5) + 1):
        if num % i == 0:
            is_prime = False
            break
    if is_prime:
        print(num)
```

### 例子2：斐波那契數列

要求：輸出斐波那契數列中嘅前 20 個數。

> **說明**：斐波那契數列（Fibonacci sequence），通常亦都被稱作黃金分割數列，係意大利數學家萊昂納多·斐波那契（Leonardoda Fibonacci）喺《計算之書》中研究理想假設條件下兔子成長率問題而引入嘅數列，因此呢個數列亦都常被戲稱為「兔子數列」。斐波那契數列嘅特點係數列嘅前兩個數都係 1，從第三個數開始，每個數都係佢前面兩個數嘅和。按照呢個規律，斐波那契數列嘅前 10 個數係：`1, 1, 2, 3, 5, 8, 13, 21, 34, 55`。斐波那契數列喺現代物理、準晶體結構、化學等領域都有直接嘅應用。

```python
"""
輸出斐波那契數列中嘅前20個數

Version: 1.0
Author: 駱昊
"""

a, b = 0, 1
for _ in range(20):
    a, b = b, a + b
    print(a)
```

> **說明**：上面循環中嘅`a, b = b, a + b`表示將變數`b`嘅值賦畀`a`，將`a + b`嘅值賦畀`b`。通過呢個遞推公式，我哋可以依次獲得斐波那契數列中嘅數。

### 例子3：尋找水仙花數

要求：找出 100 到 999 範圍內嘅所有水仙花數。

> **提示**：喺數論中，水仙花數（narcissistic number）亦都被稱為超完全數字不變數、自戀數、自冪數、阿姆斯特朗數，佢係一個 $\small{N}$ 位非負整數，其各位數字嘅 $\small{N}$ 次方和啱好等於該數本身，例如： $\small{153 = 1^{3} + 5^{3} + 3^{3}}$ ，所以 153 係一個水仙花數； $\small{1634 = 1^{4} + 6^{4} + 3^{4} + 4^{4}}$ ，所以 1634 都係一個水仙花數。對於三位數，解題嘅關鍵係將佢拆分為個位、十位、百位，再判斷係咪滿足水仙花數嘅要求，呢一點利用 Python 中嘅`//`同`%`運算符其實好容易做到。

```python
"""
找出100到999範圍內嘅水仙花數

Version: 1.0
Author: 駱昊
"""
for num in range(100, 1000):
    low = num % 10
    mid = num // 10 % 10
    high = num // 100
    if num == low ** 3 + mid ** 3 + high ** 3:
        print(num)
```

上面利用`//`同`%`拆分一個數嘅小技巧喺寫代碼嘅時候都好常用。我哋要將一個唔知有幾多位嘅正整數進行反轉，例如將 12389 變成 98321，都可以利用呢兩個運算嚟實現，代碼如下所示。

```python
"""
正整數嘅反轉

Version: 1.0
Author: 駱昊
"""
num = int(input('num = '))
reversed_num = 0
while num > 0:
    reversed_num = reversed_num * 10 + num % 10
    num //= 10
print(reversed_num)
```

### 例子4：百錢百雞問題

> **說明**：百錢百雞係我國古代數學家張丘建喺《算經》一書中提出嘅數學問題：雞翁一值錢五，雞母一值錢三，雞雛三值錢一。百錢買百雞，問雞翁、雞母、雞雛各幾何？翻譯成現代文係：公雞 5 元一隻，母雞 3 元一隻，小雞 1 元三隻，用 100 蚊買一百隻雞，問公雞、母雞、小雞各有幾多隻？

```python
"""
百錢百雞問題

Version: 1.0
Author: 駱昊
"""
for x in range(0, 21):
    for y in range(0, 34):
        for z in range(0, 100, 3):
            if x + y + z == 100 and 5 * x + 3 * y + z // 3 == 100:
                print(f'公雞: {x}隻, 母雞: {y}隻, 小雞: {z}隻')
```

上面使用嘅方法叫做**窮舉法**，亦都稱為**暴力搜索法**，呢種方法通過一項一項嘅列舉備選解決方案中所有可能嘅候選項，並檢查每個候選項係咪符合問題嘅描述，最終得到問題嘅解。上面嘅代碼中，我哋使用咗嵌套嘅循環結構，假設公雞有`x`隻，好明顯`x`嘅取值範圍係 0 到 20，假設母雞有`y`隻，佢嘅取值範圍係 0 到 33，假設小雞有`z`隻，佢嘅取值範圍係 0 到 99 且取值係 3 嘅倍數。咁樣，我哋設置好 100 隻雞嘅條件`x + y + z == 100`，設置好 100 蚊嘅條件`5 * x + 3 * y + z // 3 == 100`，當兩個條件同時滿足時，就係問題嘅正確答案，我哋用`print`函數輸出佢。呢種方法睇落比較笨拙，但對於運算能力非常強大嘅電腦嚟講，通常都係一個可行甚至係唔錯嘅選擇，只要問題嘅解存在就可以搵到佢。

事實上，上面嘅代碼仲有更好嘅寫法，既然我哋已經假設公雞有`x`隻，母雞有`y`隻，咁小雞嘅數量就應該係`100 - x - y`，咁樣減少一個條件，我哋就可以將上面三層嵌套嘅`for-in`循環改寫為兩層嵌套嘅`for-in`循環。循環次數減少咗，代碼嘅執行效率就顯著提升咗，如下所示。

```python
"""
百錢百雞問題

Version: 1.1
Author: 駱昊
"""
for x in range(0, 21):
    for y in range(0, 34):
        z = 100 - x - y
        if z % 3 == 0 and 5 * x + 3 * y + z // 3 == 100:
            print(f'公雞: {x}隻, 母雞: {y}隻, 小雞: {z}隻')
```

> **說明**：上面代碼中嘅`z % 3 == 0`係為咗確保小雞嘅數量係 3 嘅倍數。

### 例子5：CRAPS賭博遊戲

> **說明**：CRAPS又稱花旗骰，係美國拉斯維加斯非常受歡迎嘅一種桌上賭博遊戲。呢個遊戲使用兩粒骰子，玩家通過搖兩粒骰子獲得點數進行遊戲。簡化後嘅規則係：玩家第一次搖骰子如果搖出咗 7 點或 11 點，玩家勝；玩家第一次如果搖出 2 點、3 點或 12 點，莊家勝；玩家如果搖出其他點數則遊戲繼續，玩家重新搖骰子，如果玩家搖出咗 7 點，莊家勝；如果玩家搖出咗第一次搖嘅點數，玩家勝；其他點數玩家繼續搖骰子，直到分出勝負。為咗增加代碼嘅趣味性，我哋設定遊戲開始時玩家有 1000 蚊嘅賭注，每局遊戲開始之前，玩家先下注，如果玩家獲勝就可以獲得對應下注金額嘅獎勵，如果莊家獲勝，玩家就會輸掉自己下注嘅金額。遊戲結束嘅條件係玩家破產（輸光所有嘅賭注）。

```python
"""
Craps賭博遊戲

Version: 1.0
Author: 駱昊
"""
import random

money = 1000
while money > 0:
    print(f'你嘅總資產為: {money}蚊')
    # 下注金額必須大於0且小於等於玩家嘅總資產
    while True:
        debt = int(input('請下注: '))
        if 0 < debt <= money:
            break
    # 用兩個1到6均勻分布嘅隨機數相加模擬搖兩顆骰子得到嘅點數
    first_point = random.randrange(1, 7) + random.randrange(1, 7)
    print(f'\n玩家搖出咗{first_point}點')
    if first_point == 7 or first_point == 11:
        print('玩家勝!\n')
        money += debt
    elif first_point == 2 or first_point == 3 or first_point == 12:
        print('莊家勝!\n')
        money -= debt
    else:
        # 如果第一次搖骰子冇分出勝負，玩家需要重新搖骰子
        while True:
            current_point = random.randrange(1, 7) + random.randrange(1, 7)
            print(f'玩家搖出咗{current_point}點')
            if current_point == 7:
                print('莊家勝!\n')
                money -= debt
                break
            elif current_point == first_point:
                print('玩家勝!\n')
                money += debt
                break
print('你破產啦, 遊戲結束!')
```

### 總結

分支結構同循環結構都非常重要，係構建程式邏輯嘅基礎，**一定要通過大量嘅練習嚟達到融會貫通**。我哋可以用上面講嘅花旗骰遊戲作為一個標準，如果你能夠好順利咁完成呢段代碼，咁分支結構同循環結構嘅知識你就已經好好咁掌握咗啦。

