## 常用數據結構之字符串

第二次世界大戰促使咗現代電子計算機嘅誕生，世界上嘅第一台通用電子計算機名叫 ENIAC（電子數值積分計算機），誕生於美國嘅賓夕法尼亞大學，佔地167平米，重量約27噸，每秒鐘大約能夠完成約5000次浮點運算，如下圖所示。ENIAC 誕生之後被應用於導彈彈道嘅計算，而數值計算亦都係現代電子計算機最重要嘅一項功能。

<img src="res/day11/eniac.jpg" style="zoom:50%;">

隨著時間嘅推移，雖然數值運算仍然係計算機日常工作中最重要嘅組成部分，但係今日嘅計算機仲要處理大量以文本形式存在嘅信息。如果我哋希望透過 Python 程式嚟操作呢啲文本信息，就必須要先了解字符串呢種數據類型以及與佢相關嘅運算同方法。

### 字符串嘅定義

所謂**字符串**，就係**由零個或多個字符組成嘅有限序列**，一般記為：

$$
s = a_1a_2 \cdots a_n \,\,\,\,\, (0 \le n \le \infty)
$$

喺 Python 程式中，我哋將單個或多個字符用單引號或者雙引號包圍起來，就可以表示一個字符串。字符串中嘅字符可以係特殊符號、英文字母、中文字符、日文嘅平假名或片假名、希臘字母、Emoji 字符（如：💩、🐷、🀄️）等。

```python
s1 = 'hello, world!'
s2 = "你好，世界！❤️"
s3 = '''hello,
wonderful
world!'''
print(s1)
print(s2)
print(s3)
```

#### 轉義字符

我哋可以喺字符串中使用`\`（反斜杠）嚟表示轉義，亦即係話`\`後面嘅字符唔再係佢原來嘅意義，例如：`\n`唔係代表字符`\`同字符`n`，而係表示換行；`\t`亦都唔係代表字符`\`同字符`t`，而係表示制表符。所以如果字符串本身又包含咗`'`、`"`、`\`呢啲特殊嘅字符，必須要透過`\`進行轉義處理。例如要輸出一個帶單引號或反斜杠嘅字符串，需要用如下所示嘅方法。

```python
s1 = '\'hello, world!\''
s2 = '\\hello, world!\\'
print(s1)
print(s2)
```

#### 原始字符串

Python 中有一種以`r`或`R`開頭嘅字符串，呢種字符串被稱為原始字符串，意思係字符串中嘅每個字符都係佢本來嘅含義，冇所謂嘅轉義字符。例如，喺字符串`'hello\n'`中，`\n`表示換行；而喺`r'hello\n'`中，`\n`唔再表示換行，就係字符`\`同字符`n`。大家可以運行下面嘅代碼，睇下會輸出咩。

```python
s1 = '\it \is \time \to \read \now'
s2 = r'\it \is \time \to \read \now'
print(s1)
print(s2)
```

> **說明**：上面嘅變數`s1`中，`\t`、`\r`同`\n`都係轉義字符。`\t`係制表符（table），`\n`係換行符（new line），`\r`係回車符（carriage return）相當於讓輸出返到行首。對比一下兩個`print`函數嘅輸出，睇下到底有咩區別！

#### 字符嘅特殊表示

Python 中仲允許喺`\`後面仲可以跟一個八進制或者十六進制數嚟表示字符，例如`\141`同`\x61`都代表小寫字母`a`，前者係八進制嘅表示法，後者係十六進制嘅表示法。另外一種表示字符嘅方式係喺`\u`後面跟 Unicode 字符編碼，例如`\u9a86\u660a`代表嘅係中文「駱昊」。運行下面嘅代碼，睇下輸出咗咩。

```python
s1 = '\141\142\143\x61\x62\x63'
s2 = '\u9a86\u660a'
print(s1)
print(s2)
```

### 字符串嘅運算

Python 語言為字符串類型提供咗非常豐富嘅運算符，有好多運算符同列表類型嘅運算符作用類似。例如，我哋可以使用`+`運算符嚟實現字符串嘅拼接，可以使用`*`運算符嚟重複一個字符串嘅內容，可以使用`in`同`not in`嚟判斷一個字符串係咪包含另外一個字符串，我哋都可以用`[]`同`[:]`運算符從字符串取出某個字符或某些字符。

#### 拼接同重複

下面嘅例子演示咗使用`+`同`*`運算符嚟實現字符串嘅拼接同重複操作。

```python
s1 = 'hello' + ', ' + 'world'
print(s1)    # hello, world
s2 = '!' * 3
print(s2)    # !!!
s1 += s2
print(s1)    # hello, world!!!
s1 *= 2
print(s1)    # hello, world!!!hello, world!!!
```

用`*`實現字符串嘅重複係非常有意思嘅一個運算符，喺好多程式語言中，要表示一個有10個`a`嘅字符串，你只能寫成`'aaaaaaaaaa'`，但係喺 Python 中，你可以寫成`'a' * 10`。你可能覺得`'aaaaaaaaaa'`呢種寫法都冇咩唔方便嘅，但係請諗一諗，如果字符`a`要重複100次或者1000次又會點樣呢？

#### 比較運算

對於兩個字符串類型嘅變數，可以直接使用比較運算符嚟判斷兩個字符串嘅相等性或比較大小。需要說明嘅係，因為字符串喺計算機內存中都係以二進制形式存在嘅，咁字符串嘅大小比較比嘅係每個字符對應嘅編碼嘅大小。例如`A`嘅編碼係`65`， 而`a`嘅編碼係`97`，所以`'A' < 'a'`嘅結果相當於就係`65 < 97`嘅結果，呢度好明顯係`True`；而`'boy' < 'bad'`，因為第一個字符都係`'b'`比唔出大小，所以實際比較嘅係第二個字符嘅大小，顯然`'o' < 'a'`嘅結果係`False`，所以`'boy' < 'bad'`嘅結果係`False`。如果唔清楚兩個字符對應嘅編碼到底係幾多，可以使用`ord`函數嚟獲得，之前我哋有提到過呢個函數。例如`ord('A')`嘅值係`65`，而`ord('昊')`嘅值係`26122`。下面嘅代碼展示咗字符串嘅比較運算，請大家仔細睇睇。

```python
s1 = 'a whole new world'
s2 = 'hello world'
print(s1 == s2)             # False
print(s1 < s2)              # True
print(s1 == 'hello world')  # False
print(s2 == 'hello world')  # True
print(s2 != 'Hello world')  # True
s3 = '駱昊'
print(ord('駱'))            # 39558
print(ord('昊'))            # 26122
s4 = '王大錘'
print(ord('王'))            # 29579
print(ord('大'))            # 22823
print(ord('錘'))            # 38180
print(s3 >= s4)             # True
print(s3 != s4)             # True
```

#### 成員運算

Python 中可以用`in`同`not in`判斷一個字符串中係咪包含另外一個字符或字符串，同列表類型一樣，`in`同`not in`稱為成員運算符，會產生布爾值`True`或`False`，代碼如下所示。

```python
s1 = 'hello, world'
s2 = 'goodbye, world'
print('wo' in s1)      # True
print('wo' not in s2)  # False
print(s2 in s1)        # False
```

#### 獲取字符串長度

獲取字符串長度同獲取列表元素個數一樣，使用內置函數`len`，代碼如下所示。

```python
s = 'hello, world'
print(len(s))                 # 12
print(len('goodbye, world'))  # 14
```

#### 索引同切片

字符串嘅索引同切片操作同列表、元組幾乎冇區別，因為字符串都係一種有序序列，可以透過正向或反向嘅整數索引訪問其中嘅元素。但係有一點需要注意，因為**字符串係不可變類型**，所以**唔可以透過索引運算修改字符串中嘅字符**。

```python
s = 'abc123456'
n = len(s)
print(s[0], s[-n])    # a a
print(s[n-1], s[-1])  # 6 6
print(s[2], s[-7])    # c c
print(s[5], s[-4])    # 3 3
print(s[2:5])         # c12
print(s[-7:-4])       # c12
print(s[2:])          # c123456
print(s[:2])          # ab
print(s[::2])         # ac246
print(s[::-1])        # 654321cba
```

需要再次提醒大家注意嘅係，喺進行索引運算時，如果索引越界，會引發`IndexError`異常，錯誤提示信息為：`string index out of range`（字符串索引超出範圍）。

### 字符嘅遍歷

如果希望遍歷字符串中嘅每個字符，可以使用`for-in`循環，有如下所示嘅兩種方式。

方式一：

```python
s = 'hello'
for i in range(len(s)):
    print(s[i])
```

方式二：

```python
s = 'hello'
for elem in s:
    print(elem)
```

### 字符串嘅方法

喺 Python 中，我哋可以透過字符串類型自帶嘅方法對字符串進行操作同處理，假設我哋有名為`foo`嘅字符串，字符串有名為`bar`嘅方法，咁使用字符串方法嘅語法係：`foo.bar()`，呢種係透過對象引用調用對象方法嘅語法，同前面使用列表方法嘅語法係一樣嘅。

#### 大小寫相關操作

下面嘅代碼演示咗同字符串大小寫變換相關嘅方法。

```python
s1 = 'hello, world!'
# 字符串首字母大寫
print(s1.capitalize())  # Hello, world!
# 字符串每個單詞首字母大寫
print(s1.title())       # Hello, World!
# 字符串變大寫
print(s1.upper())       # HELLO, WORLD!
s2 = 'GOODBYE'
# 字符串變小寫
print(s2.lower())       # goodbye
# 檢查s1和s2嘅值
print(s1)               # hello, world
print(s2)               # GOODBYE
```

> **說明**：由於字符串係不可變類型，使用字符串嘅方法對字符串進行操作會產生新嘅字符串，但係原來變數嘅值並冇發生變化。所以上面嘅代碼中，當我哋最後檢查`s1`同`s2`兩個變數嘅值時，`s1`同`s2` 的值並冇發生變化。

#### 查找操作

如果想喺一個字符串中從前向後查找有冇另外一個字符串，可以使用字符串嘅`find`或`index`方法。喺使用`find`同`index`方法時仲可以透過方法嘅參數嚟指定查找嘅範圍，亦即係查找不必從索引為`0`嘅位置開始。

```python
s = 'hello, world!'
print(s.find('or'))      # 8
print(s.find('or', 9))   # -1
print(s.find('of'))      # -1
print(s.index('or'))     # 8
print(s.index('or', 9))  # ValueError: substring not found
```

>**說明**：`find`方法搵唔到指定嘅字符串會返回`-1`，`index`方法搵唔到指定嘅字符串會引發`ValueError`錯誤。

`find`同`index`方法仲有逆向查找（從後向前查找）嘅版本，分別係`rfind`同`rindex`，代碼如下所示。

```python
s = 'hello world!'
print(s.find('o'))       # 4
print(s.rfind('o'))      # 7
print(s.rindex('o'))     # 7
# print(s.rindex('o', 8))  # ValueError: substring not found
```

#### 性質判斷

可以透過字符串嘅`startswith`、`endswith`嚟判斷字符串係咪以某個字符串開頭同結尾；仲可以用`is`開頭嘅方法判斷字符串嘅特徵，呢啲方法都返回布爾值，代碼如下所示。

```python
s1 = 'hello, world!'
print(s1.startswith('He'))   # False
print(s1.startswith('hel'))  # True
print(s1.endswith('!'))      # True
s2 = 'abc123456'
print(s2.isdigit())  # False
print(s2.isalpha())  # False
print(s2.isalnum())  # True
```

> **說明**：上面嘅`isdigit`用嚟判斷字符串係咪完全由數字構成嘅，`isalpha`用嚟判斷字符串係咪完全由字母構成嘅，呢度嘅字母指嘅係 Unicode 字符但唔包含 Emoji 字符，`isalnum`用嚟判斷字符串係咪由字母同數字構成嘅。

#### 格式化

喺 Python 中，字符串類型可以透過`center`、`ljust`、`rjust`方法做居中、左對齊同右對齊嘅處理。如果想喺字符串嘅左側補零，都可以使用`zfill`方法。

```python
s = 'hello, world'
print(s.center(20, '*'))  # ****hello, world****
print(s.rjust(20))        #         hello, world
print(s.ljust(20, '~'))   # hello, world~~~~~~~~
print('33'.zfill(5))      # 00033
print('-33'.zfill(5))     # -0033
```

我哋之前講過，喺用`print`函數輸出字符串時，可以用下面嘅方式對字符串進行格式化。

```python
a = 321
b = 123
print('%d * %d = %d' % (a, b, a * b))
```

當然，我哋都可以用字符串嘅`format`方法來完成字符串嘅格式，代碼如下所示。

```python
a = 321
b = 123
print('{0} * {1} = {2}'.format(a, b, a * b))
```

從 Python 3.6 開始，格式化字符串仲有更為簡潔嘅書寫方式，就係喺字符串前加上`f`來格式化字符串，喺呢種以`f`打頭嘅字符串中，`{變量名}`係一個占位符，會被變量對應嘅值將其替換掉，代碼如下所示。

```python
a = 321
b = 123
print(f'{a} * {b} = {a * b}')
```

如果需要進一步控制格式化語法中變量值嘅形式，可以參照下面嘅表格來進行字符串格式化操作。

| 變量值      | 占位符     | 格式化結果    | 說明 |
| ----------- | ---------- | ------------- | ---- |
| `3.1415926` | `{:.2f}`   | `'3.14'`      | 保留小數點後兩位 |
| `3.1415926` | `{:+.2f}`  | `'+3.14'`       | 帶符號保留小數點後兩位 |
| `-1`        | `{:+.2f}`  | `'-1.00'` | 帶符號保留小數點後兩位 |
| `3.1415926` | `{:.0f}`   | `'3'` | 不帶小數 |
| `123`       | `{:0>10d}` | `'0000000123'` | 左邊補`0`，補夠10位 |
| `123`       | `{:x<10d}` | `'123xxxxxxx'` | 右邊補`x` ，補夠10位 |
| `123`       | `{:>10d}`  | `'       123'` | 左邊補空格，補夠10位 |
| `123`       | `{:<10d}` | `'123       '` | 右邊補空格，補夠10位 |
| `123456789` | `{:,}`     | `'123,456,789'` | 逗號分隔格式 |
| `0.123`     | `{:.2%}`   | `'12.30%'`    | 百分比格式 |
| `123456789` | `{:.2e}`   | `'1.23e+08'`  | 科學計數法格式 |

#### 修剪操作

字符串嘅`strip`方法可以幫我哋獲得將原字符串修剪掉左右兩端指定字符之後嘅字符串，默認係修剪空格字符。呢個方法非常有實用價值，可以用來將用戶輸入時不小心鍵入嘅頭尾空格等去掉，`strip`方法仲有`lstrip`同`rstrip`兩個版本，相信從名字大家已經猜出嚟呢兩個方法係做咩用嘅。

```python
s1 = '   jackfrued@126.com  '
print(s1.strip())      # jackfrued@126.com
s2 = '~你好，世界~'
print(s2.lstrip('~'))  # 你好，世界~
print(s2.rstrip('~'))  # ~你好，世界
```

#### 替換操作

如果希望用新嘅內容替換字符串中指定嘅內容，可以使用`replace`方法，代碼如下所示。`replace`方法嘅第一個參數係被替換嘅內容，第二個參數係替換後嘅內容，還可以透過第三個參數指定替換嘅次數。

```python
s = 'hello, good world'
print(s.replace('o', '@'))     # hell@, g@@d w@rld
print(s.replace('o', '@', 1))  # hell@, good world
```

#### 拆分與合并

可以使用字符串嘅`split`方法將一個字符串拆分為多個字符串（放在一個列表中），也可以使用字符串嘅`join`方法將列表中嘅多個字符串連接成一個字符串，代碼如下所示。

```python
s = 'I love you'
words = s.split()
print(words)            # ['I', 'love', 'you']
print('~'.join(words))  # I~love~you
```

需要說明嘅係，`split`方法默認使用空格進行拆分，我哋也可以指定其他嘅字符來拆分字符串，而且還可以指定最大拆分次數來控制拆分嘅效果，代碼如下所示。

```python
s = 'I#love#you#so#much'
words = s.split('#')
print(words)  # ['I', 'love', 'you', 'so', 'much']
words = s.split('#', 2)
print(words)  # ['I', 'love', 'you#so#much']
```

#### 編碼和解碼

Python 中除了字符串`str`類型外，還有一種表示二進制數據嘅字節串類型（`bytes`）。所謂字節串，就係**由零個或更多個字節組成嘅有限序列**。透過字符串嘅`encode`方法，我們可以按照某種編碼方式將字符串編碼為字節串，我們也可以使用字節串嘅`decode`方法，將字節串解碼為字符串，代碼如下所示。

```python
a = '駱昊'
b = a.encode('utf-8')
c = a.encode('gbk')
print(b)                  # b'\xe9\xaa\x86\xe6\x98\x8a'
print(c)                  # b'\xc2\xe6\xea\xbb'
print(b.decode('utf-8'))  # 駱昊
print(c.decode('gbk'))    # 駱昊
```

注意，如果編碼和解碼嘅方式唔一致，會導致亂碼問題（無法再現原始嘅內容）或引發`UnicodeDecodeError`錯誤，導致程序崩潰。

#### 其他方法

對於字符串類型來說，還有一個常用嘅操作係對字符串進行匹配檢查，即檢查字符串是否滿足某種特定嘅模式。例如，一個網站對用戶注冊信息中用戶名和郵箱嘅檢查，就屬於模式匹配檢查。實現模式匹配檢查嘅工具叫做正則表達式，Python 語言透過標準庫中嘅`re`模塊提供了對正則表達式嘅支持，我們會喺後續嘅課程中為大家講解呢個知識點。

### 總結

知道如何表示和操作字符串對程序員來說係非常重要嘅，因為我哋經常需要處理文本信息，Python 中操作字符串可以用拼接、索引、切片等運算符，也可以使用字符串類型提供嘅非常豐富嘅方法。
