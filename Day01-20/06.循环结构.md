## 循環結構

我哋喺寫程式嘅時候，好有可能會遇到需要重複執行某條或某些指令嘅場景，例如我哋需要每隔1秒鐘喺屏幕上輸出一次「hello, world」並持續輸出一個鐘。如下所示嘅代碼可以完成一次咁樣嘅操作，如果想持續輸出一個鐘，我哋就需要將呢段代碼寫3600次，你願意咁做嗎？

```python
import time

print('hello, world')
time.sleep(1)
```

> **說明**：Python 內置`time`模組嘅`sleep`函數可以實現程式嘅休眠，參數`1`表示休眠嘅秒數，可以用`int`或`float`類型，例如`0.05`表示`50`毫秒。關於函數同模組嘅知識，我哋會喺後續嘅課程中為大家講解。

為咗應對上述場景中嘅問題，我哋可以喺 Python 程式中使用循環結構。所謂循環結構，就係程式中控制某條或某些指令重複執行嘅結構。有咗咁樣嘅結構，頭先嘅代碼就唔需要寫 3600 次，而係寫一遍然後放喺循環結構中重複 3600 次。喺 Python 語言中構建循環結構有兩種做法，一種係`for-in`循環，另一種係`while`循環。

### for-in循環

如果明確知道循環執行嘅次數，我哋推薦使用`for-in`循環，例如上面講嘅嗰個重複 3600 次嘅場景，我哋可以用下面嘅代碼嚟實現。 注意，被`for-in`循環控制嘅代碼塊都係通過縮進嘅方式嚟構建，呢一點同分支結構中構建代碼塊嘅做法係一樣嘅。我哋被`for-in`循環控制嘅代碼塊叫做循環體，通常循環體中嘅語句會根據循環嘅設定被重複執行。

```python
"""
每隔1秒輸出一次「hello, world」，持續1小時

Author: 駱昊
Version: 1.0
"""
import time

for i in range(3600):
    print('hello, world')
    time.sleep(1)
```

需要說明嘅係，上面代碼中嘅`range(3600)`可以構建出一個從`0`到`3599`嘅範圍，當我哋將咁樣一個範圍放喺`for-in`循環中，就可以通過前面嘅循環變數`i`依次取出從`0`到`3599`嘅整數，呢個就會令`for-in`代碼塊中嘅語句重複 3600 次。當然，`range`嘅用法非常靈活，下面嘅清單列出咗使用`range`函數嘅例子：

- `range(101)`：可以用嚟產生`0`到`100`範圍嘅整數，需要注意嘅係取唔到`101`。
- `range(1, 101)`：可以用嚟產生`1`到`100`範圍嘅整數，相當於係左閉右開嘅設定，即`[1, 101)`。
- `range(1, 101, 2)`：可以用嚟產生`1`到`100`嘅奇數，其中`2`係步長（跨度），即每次遞增嘅值，`101`取唔到。
- `range(100, 0, -2)`：可以用嚟產生`100`到`1`嘅偶數，其中`-2`係步長（跨度），即每次遞減嘅值，`0`取唔到。

大家可能已經注意到了，上面代碼嘅輸出操作同休眠操作都冇用到循環變數`i`，對於唔需要用到循環變數嘅`for-in`循環結構，按照 Python 嘅程式編寫慣例，我哋通常將循環變數命名為`_`，修改後嘅代碼如下所示。雖然結果冇咩變化，但係咁樣寫顯得你更專業，逼格瞬間拉滿。

```python
"""
每隔1秒輸出一次「hello, world」，持續1小時

Author: 駱昊
Version: 1.1
"""
import time

for _ in range(3600):
    print('hello, world')
    time.sleep(1)
```

上面嘅代碼要執行一個鐘，如果想提前結束程式，喺 PyCharm 中可以點擊運行窗口上嘅停止按鈕，如下圖所示。如果喺命令提示符或終端中運行代碼，可以用組合鍵`ctrl+c`嚟終止程式。

<img src="res/day06/terminate_program.png" style="zoom:40%;">

下面，我哋用`for-in`循環實現從 1 到 100 嘅整數求和，即 $\small{\sum_{n=1}^{100}{n}}$ 。

```python
"""
從1到100嘅整數求和

Version: 1.0
Author: 駱昊
"""
total = 0
for i in range(1, 101):
    total += i
print(total)
```

上面嘅代碼中，變數`total`嘅作用係保存累加嘅結果。喺循環嘅過程中，循環變數`i`嘅值會從 1 一直取到 100。對於變數`i`嘅每個取值，我哋都執行咗`total += i`，佢等同於`total = total + i`，呢條語句實現咗累加操作。所以，當循環結束，我哋輸出變數`total` 嘅值，佢嘅值就係從 1 累加到 100 嘅結果 5050。注意，`print(total)`呢條語句前面係冇縮進嘅，佢唔受`for-in`循環嘅控制，唔會重複執行。

我哋再嚟寫一個從1到100偶數求和嘅代碼，如下所示。

```python
"""
從1到100嘅偶數求和

Version: 1.0
Author: 駱昊
"""
total = 0
for i in range(1, 101):
    if i % 2 == 0:
        total += i
print(total)
```

> **說明**：上面嘅`for-in`循環中我哋使用咗分支結構嚟判斷循環變數`i`係咪偶數。

我哋都可以修改`range`函數嘅參數，將起始值同跨度修改為`2`，用更簡單嘅代碼實現從 1 到 100 嘅偶數求和。

```python
"""
從1到100嘅偶數求和

Version: 1.1
Author: 駱昊
"""
total = 0
for i in range(2, 101, 2):
    total += i
print(total)
```

當然， 更簡單嘅辦法係使用 Python 內置嘅`sum`函數求和，咁樣我哋連循環結構都省掉咗。

```python
"""
從1到100嘅偶數求和

Version: 1.2
Author: 駱昊
"""
print(sum(range(2, 101, 2)))
```

### while循環

如果想構建循環結構但係又唔能夠確定循環重複嘅次數，我哋推薦使用`while`循環。`while`循環通過布爾值或能產生布爾值嘅表達式嚟控制循環，當布爾值或表達式嘅值為`True`時，循環體（`while`語句下方保持相同縮進嘅代碼塊）中嘅語句就會被重複執行，當表達式嘅值為`False`時，結束循環。

下面我哋用`while`循環嚟實現從 1 到 100 嘅整數求和，代碼如下所示。

```python
"""
從1到100嘅整數求和

Version: 1.1
Author: 駱昊
"""
total = 0
i = 1
while i <= 100:
    total += i
    i += 1
print(total)
```

相較於`for-in`循環，上面嘅代碼我哋喺循環開始前增加咗一個變數`i`，我哋使用呢個變數嚟控制循環，所以`while`後面畀出咗`i <= 100`嘅條件。喺`while`嘅循環體中，我哋除咗做累加，仲需要令變數`i`嘅值遞增，所以我哋添加咗`i += 1`呢條語句，咁樣`i`嘅值就會依次取到1、2、3、……，直到 101。當`i`變成 101 時，`while`循環嘅條件唔再成立，代碼會離開`while`循環，呢個時候我哋輸出變數`total`嘅值，佢就係從 1 到 100 求和嘅結果 5050。

如果想實現從 1 到 100 嘅偶數求和，我哋可以對上面嘅代碼稍作修改。

```python
"""
從1到100嘅偶數求和

Version: 1.3
Author: 駱昊
"""
total = 0
i = 2
while i <= 100:
    total += i
    i += 2
print(total)
```

### break同continue

如果將`while`循環嘅條件設置為`True`，即係令條件恆成立會點樣呢？我哋睇下下面嘅代碼，都係使用`while`構建循環結構，計算 1 到 100 嘅偶數和。

```python
"""
從1到100嘅偶數求和

Version: 1.4
Author: 駱昊
"""
total = 0
i = 2
while True:
    total += i
    i += 2
    if i > 100:
        break
print(total) 
```

上面嘅代碼中使用`while True`構建咗一個條件恆成立嘅循環，亦即係話如果唔做特殊處理，循環係唔會結束嘅，呢個就係我哋常講嘅「死循環」。為咗喺`i`嘅值超過 100 後令循環停落嚟，我哋使用咗`break`關鍵字，佢嘅作用係終止循環結構嘅執行。需要注意嘅係，`break`只能終止佢所在嘅嗰個循環，呢一點喺使用嵌套循環結構時需要引起注意，後面我哋會講到咩係嵌套嘅循環結構。除咗`break`之外，仲有另一個喺循環結構中可以使用嘅關鍵字`continue`，佢可以用嚟放棄本次循環後續嘅代碼直接令循環進入下一輪，代碼如下所示。

```python
"""
從1到100嘅偶數求和

Version: 1.5
Author: 駱昊
"""
total = 0
for i in range(1, 101):
    if i % 2 != 0:
        continue
    total += i
print(total)
```

> **說明**：上面嘅代碼使用`continue`關鍵字跳過咗`i`係奇數嘅情況，只有喺`i`係偶數嘅前提下，先會執行到`total += i`。

### 嵌套嘅循環結構

同分支結構一樣，循環結構都係可以嵌套嘅，亦即係話喺循環結構中仲可以構建循環結構。下面嘅例子演示咗點樣通過嵌套嘅循環嚟輸出一個乘法口訣表（九九表）。

```python
"""
打印乘法口訣表

Version: 1.0
Author: 駱昊
"""
for i in range(1, 10):
    for j in range(1, i + 1):
        print(f'{i}×{j}={i * j}', end='\t')
    print()
```

上面嘅代碼中，`for-in`循環嘅循環體中又用到咗`for-in`循環，外面嘅循環用嚟控制產生`i`行嘅輸出，而裡面嘅循環就用嚟控制喺一行中輸出`j`列。顯然，裡面嘅`for-in`循環嘅輸出就係乘法口訣表中嘅一整行。所以喺裡面嘅循環完成時，我哋用咗一個`print()`嚟實現換行嘅效果，令下面嘅輸出重新另起一行，最後嘅輸出如下所示。

```
1×1=1	
2×1=2	2×2=4	
3×1=3	3×2=6	3×3=9	
4×1=4	4×2=8	4×3=12	4×4=16	
5×1=5	5×2=10	5×3=15	5×4=20	5×5=25	
6×1=6	6×2=12	6×3=18	6×4=24	6×5=30	6×6=36	
7×1=7	7×2=14	7×3=21	7×4=28	7×5=35	7×6=42	7×7=49	
8×1=8	8×2=16	8×3=24	8×4=32	8×5=40	8×6=48	8×7=56	8×8=64	
9×1=9	9×2=18	9×3=27	9×4=36	9×5=45	9×6=54	9×7=63	9×8=72	9×9=81
```

### 循環結構嘅應用

#### 例子1：判斷質數

要求：輸入一個大於 1 嘅正整數，判斷佢係咪質數。

> **提示**：質數指嘅係只能被 1 和自身整除嘅大於 1 嘅整數。例如對於正整數 $\small{n}$，我哋可以通過喺 2 到 $\small{n - 1}$ 之間尋找有冇 $\small{n}$ 嘅因子，嚟判斷佢到底係咪一個質數。當然，循環唔使從 2 開始到 $\small{n - 1}$ 結束，因為對於大於 1 嘅正整數，因子應該都係成對出現嘅，所以循環到 $\small{\sqrt{n}}$ 就可以結束啦。

```python
"""
輸入一個大於1嘅正整數判斷佢係咪質數

Version: 1.0
Author: 駱昊
"""
num = int(input('請輸入一個正整數: '))
end = int(num ** 0.5)
```

```python
import time

start = time.time()
is_prime = True
for factor in range(2, end + 1):
    if num % factor == 0:
        is_prime = False
        break
end_time = time.time()
if is_prime and num != 1:
    print(f'{num}是質數')
else:
    print(f'{num}不是質數')
print(f'耗時: {end_time - start:.3f}秒')
```

> **說明**：上面嘅代碼中，我哋用`time`模組計數程式執行嘅時間，並且使用咗`break`關鍵字喺判斷出唔係質數嘅時候提前終止循環，咁樣可以提升程式嘅執行效率。另外需要注意`num != 1`呢個判斷條件，因為 1 唔係質數。

#### 例子2：猜數字遊戲

**要求**：電腦隨機生成一個 1 到 100 之間嘅數字，用戶輸入數字猜測，提示係大咗定係細咗，直到猜中為止。猜中後顯示猜咗幾多次。

> **提示**： Python 內置`random`模組中嘅`randint`函數可以生成指定範圍內嘅隨機整數，例如`random.randint(1, 100)`就可以產生 1 到 100 之間嘅隨機整數（包含 1 同 100）。

```python
"""
猜數字遊戲

Version: 1.0
Author: 駱昊
"""
import random

target_number = random.randint(1, 100)
counter = 0
while True:
    counter += 1
    input_number = int(input('請輸入數字: '))
    if input_number < target_number:
        print('數字太細啦！')
    elif input_number > target_number:
        print('數字太大啦！')
    else:
        print('恭喜你，猜中啦！')
        break
print(f'你一共猜咗{counter}次')
```

#### 例子3：打印倒三角形

```python
"""
打印倒三角形

Version: 1.0
Author: 駱昊
"""
row = int(input('請輸入行數: '))
for i in range(row):
    for _ in range(i):
        print(' ', end='')
    for _ in range(row - i):
        print('*', end=' ')
    print()
```

> **說明**：這個例子使用咗嵌套嘅`for-in`循環，其中第一個內層循環負責輸出星號前嘅空格，第二個內層循環負責輸出星號。你亦可以喺一個循環中做多個輸出，或者喺一個循環中計算好一個字符串，然後用`print`函數輸出。上面嘅`print(' ', end='')`中，`end=''`表示輸出完一個空格之後唔換行，咁樣可以令後面嘅輸出喺同一行。`print('*', end=' ')`表示輸出完一個星號之後，後面再加一個空格，咁樣可以令星號之間有間隔。最後嘅`print()`係空嘅，佢嘅作用係換行。

### 總結

本節課為大家詳細介紹咗循環結構，學識咗循環結構，你就可以編寫出重複執行特定任務嘅程式。結合之前學到嘅分支結構，你就可以解決現實世界中更加複雜嘅問題啦。接下來嘅課程，我哋會通過實戰案例嚟鞏固你對分支同循環結構嘅理解。繼續努力啦！
